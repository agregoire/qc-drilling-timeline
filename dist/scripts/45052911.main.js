QcDrillingTimeline={init:function(){"use strict";this.clock=new this.Views.Clock({el:$("#clock")}),this.map=new this.Views.Map,this.markersView=new this.Views.Markers({clock:this.clock.model}),this.slider=new this.Views.Slider({clock:this.clock.model})},resizeMap:function(){"use strict";var a=document.getElementById("panel").clientHeight,b=$(window).height();$("#map-canvas").css("height",b-a+"px").css("top",a+"px")}},$(window).resize(function(){"use strict";QcDrillingTimeline.resizeMap()}),$(document).ready(function(){"use strict";QcDrillingTimeline.init(),QcDrillingTimeline.resizeMap()}),this.JST=this.JST||{},this.JST["app/scripts/templates/clock.ejs"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<span id="year" class="h2">'+(null==(__t=year)?"":__t)+'</span>\n<a href="#" id="play"\n class="',__p+=running?"running":"stopped",__p+='">\n  ',__p+=running?"\n  Arrêter\n  ":"\n  Démarrer\n  ",__p+="\n</a>";return __p},QcDrillingTimeline.Views=QcDrillingTimeline.Views||{},function(){"use strict";QcDrillingTimeline.Views.Map=Backbone.View.extend({id:"map-canvas",initialize:function(){var a={center:{lat:47.248242,lng:-70.263062},zoom:6,styles:[{stylers:[{saturation:-100},{gamma:1}]},{elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"water",stylers:[{visibility:"on"},{saturation:50},{gamma:0},{hue:"#50a5d1"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#333333"}]},{featureType:"road.local",elementType:"labels.text",stylers:[{weight:.5},{color:"#333333"}]},{featureType:"transit.station",elementType:"labels.icon",stylers:[{gamma:1},{saturation:50}]}]};this.map=new google.maps.Map(document.getElementById(this.id),a)},render:function(){return this}})}(),QcDrillingTimeline.Models=QcDrillingTimeline.Models||{},function(){"use strict";QcDrillingTimeline.Models.Marker=Backbone.Model.extend({localStorage:new Store("qc-drilling-timeline"),defaults:{number:"",name:"",region:"",latitude:0,longitude:0,company:"",start:"",end:""},visible:function(){var a=QcDrillingTimeline.clock.model.get("year");return a>=this.get("start")?!0:!1},active:function(){var a=QcDrillingTimeline.clock.model.get("year");return a>=this.get("start")&&a<=this.get("end")?!0:!1}})}(),QcDrillingTimeline.Models=QcDrillingTimeline.Models||{},function(){"use strict";QcDrillingTimeline.Models.Clock=Backbone.Model.extend({defaults:{year:1860,maxYear:2013,minYear:1860,timeout:null,running:!1},start:function(){var a=this;this.set("running",!0),this.get("year")<this.get("maxYear")?this.timeout=setTimeout(function(){a.set("year",a.get("year")+1),a.start()},500):this.set("running",!1)},stop:function(){this.set("running",!1),clearTimeout(this.timeout)}})}(),QcDrillingTimeline.Collections=QcDrillingTimeline.Collections||{},function(){"use strict";QcDrillingTimeline.Collections.Markers=Backbone.Collection.extend({model:QcDrillingTimeline.Models.Marker,url:"drillings.json"})}(),QcDrillingTimeline.Views=QcDrillingTimeline.Views||{},function(){"use strict";QcDrillingTimeline.Views.Marker=Backbone.View.extend({initialize:function(){this.marker=null,this.infoWindow=null,this.map=QcDrillingTimeline.map.map},render:function(){return null===this.marker&&this.buildMarker(),this.model.visible()?this.show():this.hide(),this},activeIcon:function(){return{path:google.maps.SymbolPath.CIRCLE,fillOpacity:1,fillColor:"#ff0000",strokeOpacity:1,strokeColor:"#000000",strokeWeight:1,scale:7}},inactiveIcon:function(){return{path:google.maps.SymbolPath.CIRCLE,fillOpacity:.7,fillColor:"#aaaaaa",strokeOpacity:.7,strokeColor:"#555555",strokeWeight:1,scale:5}},buildMarker:function(){var a=this;this.marker=new google.maps.Marker({position:new google.maps.LatLng(this.model.get("latitude"),this.model.get("longitude")),map:this.map,icon:this.activeIcon()});var b='<div class="info-window"><h1>'+this.model.get("name")+"</h1><h2>Puits numéro "+this.model.get("number")+"<br>"+this.model.get("company")+"</h2>",c="";c=this.model.get("start")===this.model.get("end")?"<p>Année de forage: "+this.model.get("start")+"</p>":"<p>Année de début de forage: "+this.model.get("start")+"</p><p>Année de fin de forage: "+this.model.get("end")+"</p>";var d="</div>";this.infoWindow=new google.maps.InfoWindow({content:b+c+d}),google.maps.event.addListener(this.marker,"click",function(){a.infoWindow.open(a.map,a.marker)})},hide:function(){this.marker.setVisible(!1)},show:function(){null===this.marker.getMap()&&this.marker.setMap(this.map),this.marker.getVisible()===!1&&this.marker.setVisible(!0),this.model.active()?this.marker.getIcon().fillColor===this.inactiveIcon().fillColor&&(this.marker.setIcon(this.activeIcon()),this.marker.setZIndex(google.maps.Marker.MAX_ZINDEX+1)):this.marker.getIcon().fillColor===this.activeIcon().fillColor&&(this.marker.setIcon(this.inactiveIcon()),this.marker.setZIndex(100))}})}(),QcDrillingTimeline.Views=QcDrillingTimeline.Views||{},function(){"use strict";QcDrillingTimeline.Views.Markers=Backbone.View.extend({initialize:function(a){var b=this;this.markerViews=[],this.listenTo(a.clock,"change",this.render),this.collection=new QcDrillingTimeline.Collections.Markers,this.collection.fetch({success:function(){b.render()}})},render:function(){var a=this;if(0===this.markerViews.length)this.collection.each(function(b){var c=new QcDrillingTimeline.Views.Marker({model:b});a.markerViews.push(c),c.render()});else for(var b=this.markerViews.length-1;b>=0;b--)this.markerViews[b].render()}})}(),QcDrillingTimeline.Views=QcDrillingTimeline.Views||{},function(){"use strict";QcDrillingTimeline.Views.Clock=Backbone.View.extend({template:JST["app/scripts/templates/clock.ejs"],initialize:function(){this.model=new QcDrillingTimeline.Models.Clock,this.listenTo(this.model,"change",this.render),this.render()},events:{"click #play":"toggleClock","change #year":"changeYear"},toggleClock:function(){return this.model.get("running")===!0?this.model.stop():this.model.start(),!1},stopClock:function(){this.model.stop()},changeYear:function(){this.model.set("year",parseInt($("#year").html()))},render:function(){this.$el.html(this.template(this.model.toJSON()))}})}(),QcDrillingTimeline.Views=QcDrillingTimeline.Views||{},function(){"use strict";QcDrillingTimeline.Views.Slider=Backbone.View.extend({initialize:function(a){var b=this;this.model=a.clock,this.maxYear=this.model.get("maxYear"),this.minYear=this.model.get("minYear"),$("#slider").slider({max:this.maxYear,min:this.minYear,slide:function(a,c){b.model.stop(),b.model.set("year",c.value),b.render()}}),this.adaptSlider(),this.listenTo(this.model,"change",this.render),$(window).resize(function(){b.adaptSlider()})},render:function(){$("#slider").slider("value",this.model.get("year"))},adaptSlider:function(){var a=$(window).width(),b=0;b=a>1200?(this.maxYear-this.minYear)/15:(this.maxYear-this.minYear)/5,$("#slider").slider("pips",{step:b,rest:"label"})}})}();